# Linux_Shell
## Chapter 1 Shell 簡介
### 1. Linux/BSD 系統
    1. 核心 (kernel)
    2. shell: 居於系統核心和操作者之間方便溝通的介面
    3. 工具程式 
## Chapter 2 佈署 Bash shell的環境
### 1. Windows 平台佈署 bash shell 環境
    1. Cygwin
    2. MSYS2
## Chapter 3 基礎概念介紹
### 1. 登入、登出
    1.登入: ssh 帳號@主機名稱或IP
    2.登出: exit
### 2. 檔案、目錄
    1. 檔案
        1. 型態代碼:檔案型態
        2. "-" : 一般檔案
        3. d : 目錄
        4. l : 符號連結檔
        5. b : 區塊設定檔
        6. c : 字元設備檔
        7. s : Socket 檔
        8. p : 管線檔 
    2. 目錄: 切換路徑 cd
    3. 檔案權限
        1. 三種身分: u: user，檔案擁有者；g: group，和自己同一組的人；o: other，其他人；a: all，所有人
        2. 四種權限: r: read，讀取；w: write，寫入；x: execute，執行；s: set，特殊權限
    4. 設定權限: chmod 
### 3. 萬用字元與跳脫字元
    1. 萬用字元
        1. *:代表任意字串，可以為空字串
        2. ?:代表一個字元，但不可以為空 
    2. 跳脫字元: \，除去特殊字元的作用
### 4. 字元集合
### 5. 括號擴展
### 6. 管線: 一個程式的輸出，可以變成另一個程式的輸入
    1. 用法: 命令1|命令2
### 7. 前景工作、背景工作
    1. ./hello.sh &: "&" 表示將hello.sh丟到背景執行，系統會回傳該程式的執行編號
## Chapter 4 Bash Shell 程式結構
### 1. Bash Shell 結構: 主要由變數設定、內建命令、shell語法結構、函式與其他命令列程式所組成
    1. 若列以"#"開頭，bash會視為註解而忽略不處理
    2. 設定執行權: chmod +x script檔名
    3. 執行bash script: ./test.sh；"./"表示在當前目錄下，執行test.sh
### 2. Bash shell 程式快速入門
    1. 註解: 
        1. 單行註解: #
        2. 多行註解: :<<EOF /n 註解列1 /n 註解列2 /n EOF
    2. 變數:
        1. 變數 = 值
        2. 取得變數內容: $變數
    3. 陣列: A[0] = 1
    4. 萬用字元
    5. 標準輸出/輸入/錯誤以及I/O轉向
        1. 輸出轉向 ">"
        2. 轉向附加 ">>"
    6. 函示
    7. 測試真假值: 命令回傳值會儲存在$?中，0為真，非0則為假
    8. 條件判斷:if...then...
    9. 迴圈
        1. for迴圈: for...in...do...done
        2. while迴圈: while...do...done
## Chapter 5 基本操作
### 1. 內建命令
    1. help: 顯示所有bash內建命令的清單，或某一內建命令的用法
    2. echo: 顯示一段文字，預設自動換列
    3. printf: 依格式顯示參數內容
    4. declare: 宣告變數，並給予變數不同的屬性，可使用typeset取代declare
    5. pwd: 顯示目前的工作目錄
    6. cd: 改變目錄位置
        1. cd: 回到家目錄
        2. cd -: 回到先前的目錄
        3. cd ..: 回到上一層目錄
    7. dirs: 顯示目錄堆疊中的內容
    8. exit: 離開bash shell或結束script程式
    9. logout: 登出login shell
    10. history: 顯示過去曾經執行過的shell指令
    11. fc: 列出登入主機之後，最近執行過的指令
    12. set: 設定bash shell的屬性
    13. time: 在script或指令執行完後，顯示real, user, cpu三種耗用時間的統計
    14. read: 由標準輸入讀取一列資料
### 2. 命令列程式
    1. which: 由預設的路徑中，找出命令列程式的檔案位置
    2. locate: 有檔名資料庫中，找出包含有"關鍵字"的檔案路徑
    3. date: 顯示、設定系統的日期時間
    4. mkdir: 建立新目錄
    5. rmdir: 移除空目錄
    6. rm: 刪除檔案
    7. find: 在階層目錄中尋找檔案
    8. tar: 將檔案或目錄包成一個檔案 (也可反向解開)，並保留目錄結構與檔案權限屬性
    9. basename: 取得路徑名稱中最後的檔名部分
    10. dirname: 取得路徑名稱中的目錄部分
    11. diff: 比較兩個檔案之間的差異
    12. openssl: OpenSSL命令列工具
### 3. 執行多個命令的方法
    1. 命令1; 命令2; 命令3 :不論先前命令是否成功完成，每個指令皆會執行一次
    2. 命令1&& 命令2&& 命令3 :先前命令必須成功完成，才會執行下一個指令
### 4. 紀錄命令的執行過程
    1. 用法: script log.txt
    2. 查看記錄檔: cat log.txt | more
## Chapter 6 變數與字串操作
### 1. 設定變數: 變數名稱=值；等號兩邊不可以有空格
### 2. 變數值與字串組合
    1. 取得變數: ${變數名稱}
    2. 變數組合: printf "格式字串" 字串或變數值
### 3. 取消變數: 從變數空間將變數移除 
    1. unset 變數名稱
        1. unset -v 變數名稱: 取消變數
        2. unset -f 函示名稱: 取消函示
    2. 清空變數: 將變數內容刪除，其值為null
        1. 變數名稱=
    3. 判斷變數是否為空值: [["$var"]] || echo "var 變數為空"
### 4. 變數與引號: 在雙引號中，會執行替換變數，單引號則直接顯示所見即所得的字串
### 5. 環境變數
    1. 輸出變數: 使父shell的變數變成環境變數，則此變數即可被子shell取用
        1. 輸出變數: export 變數 
        2. 列出所有環境變數: export or export -p
        3. 取消環境變數值: 變數= or unset 變數
### 6. 調整變數屬性
    1. 參考變數: 當被參考的變數值改變時，參考的值也會改變
        1. declare -n ref=var
    2. 唯讀變數: 不能修改變數內容
        1. readonly 變數名稱
        2. declare -r 變數名稱
### 7. 陣列
    1. 宣告: declare -a 陣列名稱
    2. 用法:
        1. 空陣列: a=()
        2. 設定元素值: a[0]=5    
        3. 取出所有元素值: echo ${a[@]}
        4. 元素個數: ${#a[@]}
        5. 索引列表: ${!a[@]}
        6. 取消陣列或陣列元素: unset a or unset a[0]
    3. 關聯式陣列: 使用字串作為"鍵"
## Chapter 7 進階變數 
### 1. 變數擴展
    1. 測試變數是否存在: ${待測變數-預設值}
    2. 變數擴展的種類: 空值代表符號":"
        1. ${待測變數:-預設值}: 若待測變數為空或不存在，則傳回預設值  
        2. ${待測變數:=預設值}: 當待測變數不存在或為空時，將待測變數設為預設值；若待測變數存在，則回傳待測變數的值
        3. ${待測變數:?提示訊息}: 當待測變數為空值時，則顯示提示訊息，並停止script
        4. ${待測變數:+非空字串}: 當待測變數存在時或非空時，則回傳非空字串
    3. 字串切片: 
        1. ${變數:位置起點}
        2. ${變數:位置起點:長度}
    4. 取部分位置變數: ${@:起點}
    5. 計算字串長度: ${#變數名稱}
    6. 字串切換大小寫
        1. ${變數名稱^}: 第一個字元變大寫
        2. ${變數名稱^^}: 所有字元變大寫
        3. ${變數名稱,}: 第一個字元變小寫
        4. ${變數名稱,,}: 所有字元變小寫
    7. 比對樣式
        1. 從前面比對，刪最短的: ${變數#樣式}
        2. 從前面比對，刪最長的: ${變數##樣式}
        3. 從後面比對，刪最短的: ${變數%樣式}
        2. 從後面比對，刪最長的: ${變數%%樣式}
    8. 取代或刪除部分字串
        1. 只替換第一個符合的字串: ${變數/樣式/替換字串} 
        2. 替換全部符合的字串: ${變數//樣式/替換字串} 
        3. 只刪除一個符合的字串: ${變數/樣式/} 
        2. 刪除全部符合的字串: ${變數//樣式/} 
### 2. 命令替換: 將命令執行後所產生的標準輸出放入變數中
    1. 用法: 變數名稱=$ (命令)  
### 3. 算術擴展: $ ((算術式))
## Chapter 8 算術運算
### 1. 簡介
    1. 進行計算前，變數會被替換，擴展式會先展開
    2. 求值時，若變數不存在或空值，則該變數為0
    3. 數字0開頭，視為8進位數字；數字0x或0X開頭，視為16進位數字
### 2. 算術擴展: $((運算式))
### 3. 外部程式expr做算術運算
    1. r='expr 參數1\|參數2': 若參數1存在、非空、不為0，則傳回參數1的值，反之，傳回參數2的值
### 4. 使用$[]做算術運算
### 5. 使用declare與let做算術運算
## Chapter 9 流程控制
### 1. 命令的結束狀態: 若狀態值為0，則判斷為真，反之，若狀態值非0，則判斷為假
### 2. if 條件判斷: 
    1. 語法結構
        1. if 條件測試1 ; then 
        2.    命令區塊1
        3. elif 條件測試2; then 
        4.    命令區塊2 
        5. else 命令區塊3
        6. fi
    3. 條件判斷式的真假值
        1. 檔案屬性的判斷式
        2. 字串的條件判斷式
        3. 算式的條件判斷式
        4. Bash 選項的條件判斷式
### 3. case 條件判斷
    1. 語法結構
        1. case 待側項 in
        2.    樣式串列1) 命令區塊1;;
        3.    樣式串列2) 命令區塊2;;
        4.    樣式串列3) 命令區塊3;;
        5.    ...
        6.    *) 命令區塊;;
        7.    esac
    2. 多重比對: 可以符合一個或一個以上的樣式，且比對符合後，仍可繼續執行其他命令
### 4. for 迴圈
    1. 語法結構: 
        1. for 變數 in 串列 / for ((初始條件; 終止條件; 異動項))
        2. do
        3.    命令區塊
        4. done 
    2. 無窮迴圈: for((;1;)) 
### 5. while 迴圈: 條件測試為真才進命令區塊
    1. 語法結構: 
        1. while 條件測試
        2. do
        3.    命令區塊
        4. done 
    2. 無窮迴圈: while ((1)) 
### 6. until 迴圈: 條件測試為假才進命令區塊
    1. 語法結構: 
        1. unitl 條件測試
        2. do
        3.    命令區塊
        4. done 
    2. 無窮迴圈: until ((0))
### 7. select: 建立簡易選單
    1. 語法結構: 
        1. select 選項變數 in 串列
        2. do
        3.    命令區塊
        4. done 
### 8. break 與continue
    1. break: 跳出一層迴圈；若要跳出多層迴圈，可在break命令後，加入層數n 
    2. continue: 跳過本次迴圈，重新由下一個迴圈開始執行
## Chapter 10 函式
### 1. 函式
    1. 語法結構
        1. 函式名稱()
        2. {
        3. 命令區塊
        4. }
    2. 呼叫函式: 函式名稱 參數1 ...
    3. 函式結束: 遇到return命令
### 2. 函式與變數作用範圍
    1. 函式作用範圍: 僅在定義的shell環境中有效；若要傳遞給子shell環境中使用，可使用export -f 函式名稱，將該函式變成環境變數
    2. 變數的作用範圍: 若沒有設定變數屬性，則在script中自訂的變數，稱為全域變數
### 3. 位置參數
    1. $0代表script檔名，$1代表第一個位置參數，$2代表第二個位置參數，${n}代表第n個位置參數
    2. 移動位置參數: shift n 代表往前移動的次數，若一直執行shift (次數>=n)，最後會將所有位置參數清空
    3. 指定位置參數值: 使用命令 set 可以指定位置參數的值，稱為重置(reset)
        1. 重置所有位置參數: set --
### 4. 建立函式庫
    1.  若某些函式經常被使用，可以將這些函式抽出，集中存成一個檔案，作為函式庫
    2.  使用函式庫語法
        1. . 路徑/函式庫檔名
        2. source 路徑/函式庫檔名   
### 5. 遞迴函式: 函式可以呼叫自己本身
## Chapter 11 轉向
### 1. 檔案代碼
    1. 作業系統預設指派:
        1. 0: 標準輸入
        2. 1: 標準輸出
        3. 2: 標準錯誤
        4. 10以上: 開啟新檔案
### 2. 操作檔案
    1. 開啟檔案語法
        1. 可讀寫: exec fd<>檔案    
        2. 唯讀: exec fd<檔案
        3. 唯寫: exec fd>檔案
    2. 關閉檔案語法
        1. exec fd<&-
    3. 使用read讀取檔案
        1. read <&fd
    4. 複製檔案代碼
        1. 複製轉向輸入的檔案代碼m，存成檔案代碼n(隨即關閉檔案代碼m): exex n<&m(-)
        2. 複製轉向輸出的檔案代碼m，存成檔案代碼n(隨即關閉檔案代碼m): exex n>&m(-)
### 3. 轉向用法
    1. 轉向輸入: 使用檔案做輸入，指定其檔案代碼為fd
        1. fd<檔案
    2. 轉向輸出: 使用檔案做輸出，指定其檔案代碼為fd，若檔案不存在則新建檔案，若存在則該檔內容會被清空
        1. fd>檔案
    3. 轉向附加: 若檔案存在則把輸出寫在檔案後面
        1. fd>>檔案
## Chapter 12 信號和trap陷阱觸發
### 1. 信號
    1. 行程編號 PID 
        1. 列出記憶體中所有行程: ps auxw
        2. 找出指定的行程，例如要找named: ps auxw | grep named |grep -v grep
    2. 信號列表
        1. 系統定義的信號: kill -l
        2. 終止行程: kill -9 PID 
### 2. trap的運用
    1. 向shell註冊信號，只要系統產生此特定的信號，trap指令就會觸發，並執行trap命令中的"觸發指令" 
        1. 語法: trap '觸發指令' 信號串列 
        2. 建議使用單引號含括"觸發指令"，避免bash對觸發命令進行變數替換等動作
    2. 恢復信號串列原本的作用
        1. 語法: trap - 信號串列
    3. 忽略系統發出的信號串列
        1. 語法: trap '' 信號串列
        2. KILL與STOP的信號串列無法被trap捕捉和忽略
    4. 列出目前trap向shell註冊的信號列表
        1. 語法: trap -p
## Chapter 13 sed和awk入門
### 1. 正規表示式
    1. ".":代表任意字元
    2. "^":代表位置在列的開頭
    3. "$":代表位置在列的最後面
    4. "...":代表字元串列中的一個字元
    5. "*": 代表前面的字元有0個或0個以上
### 2. sed的用法
    1. sed是一種非交談式的串流編輯器，可動態編輯檔案
    2. 語法:
        1. sed '樣式命令' 檔案
        2. 多個樣式命令: sed -e '樣式命令1' -e '樣式命令2' 檔案
### 3. awk的用法
    1. awk是一種可以處理資料、產生格式化報表的語言
    2. 常用的作用格式
        1. awk '樣式' 檔案: 把符合樣式的資料列顯示出來
        2. awk '{動作}' 檔案: 對每一列都執行{}中的動作
        3. awk '樣式{動作}' 檔案: 把符合樣式的資料列，執行{}中的動作
## Chapter 14 行程管理和工作控制
### 1. 行程管理
    1. ps命令: 觀看目前行程的狀態資訊(靜態)
        1. 語法: ps 選項
        2. System V 風格: ps -ax
        3. BSD 風格: ps ax
        4. GNU 風格: ps --pid $$
    2. 行程資訊
        1. PID: 行程編號
        2. PPID: 父行程的行程編號
    3. top命令:  持續觀察目前行程的狀態資訊(動態)
    4. htop命令:  持續觀察目前行程的狀態資訊(動態)
    5. 傳送信號: 先發送信號給行程，讓行程自己完成該做的事，若行程不聽從指揮，再發送強制信號
    6. 調整行程優先權
        1. nice值: 行程進入執行排程的優先度；nice值通常介於-20~20；nice值越小優先度越高 
    7. nice命令
        1. 語法: nice -n nice值 程式
        2. 指定程式執行時的優先權為某一nice值
    8.  renice命令
        1. 語法: renice -p PID -g 群組 -u 使用者名稱
        2. 調整某一個已執行行程的優先權
    9. PRI和NI
        1. 在top和htop的輸出欄位有一個PRI的欄位
        2. PRI是一種優先權的表示法，與nice值(NI)不同的是，PRI>=0
        3. PRI = NI+20
### 2. 工作控制
    1. &: 將指令丟到背景執行 
        1. ex: ./sleep2.sh &
    2. bg: 將暫停的工作，丟到背景執行
        1. 用法1 將現在的工作丟到背景執行:bg
        2. 用法2 將工作編號n 的工作丟到背景:bg n
        3. 用法3 將程式名稱含有sl字串的工作丟到背景:bg %?sl
    3. fg: 將暫停的工作，拉回前景執行
        1. 用法: fg 工作規格
    4. jobs: 列出工作
        1. 用法: jobs or jobs -l
    5. disown: 移除工作
        1. 用法: disown %工作編號
    6. kill: 傳送信號給行程或工作
        1. ex 傳送TERM 的信號給編號2的工作，命令他結束行程: kill -TERM %2
    7. wait: 等待子行程結束，傳回最後一個命令的執行狀態
        1. 用法: wait 行程編號
    8. suspend: 暫停目前的shell
### 3. 行程變換
    1. 將標準輸出一次倒給多行程作為輸入；或者，由多個行程取得其輸出，然後倒給某支程式去執行
### 4. 平行行程 
    1. 發揮多核心效能的做法
        1. 傳統背景執行符號"&"
        2. 合作行程coproc
        3. GNU平行行程工具parallel 
    2. taskset和CPU偏好
        1. 執行指令時，指定行程的CPU偏好: taskset 位元遮罩 欲直行的指令 選項或參數 
        2. 查詢行程的CPU偏好: taskset -p 行程編號
        3. 使用位元遮罩變更行程的CPU偏好: taskset -p 位元遮罩 行程編號
        4. 使用CPU編號變更行程的CPU偏好: taskset -pc CPU實際編號 行程編號
    3. 合作行程 (co-process)
        1.  非同步執行的平行行程
        2.  coproc [自訂行程名稱] 命令 [轉向]
    4. 使用GNU parallel
        1. 執行格式: parallel 選項 欲執行的命令 參數 
## Chapter 15 歷史指令
### 1. 歷史指令功能
    1. 歷史指令檔路徑檔名，由內建變數HISTFILE定義
    2. 精簡歷史指令檔，HISTIGNORE可控制某些指令不予存入，例如常見的ls, cd, ps指令，重複的指令也可設定只存一個就好
        1. export HISTIGNORE=ls:ps:cd:t*:\&
    3.history命令: 可列出歷史指令
    4.fc命令: 可列出登入主機後最近執行過的指令 
### 2. 歷史指令擴展
    1. 功能
        1. 叫用歷史指令
        2. 叫用先前的指令，並安插參數
        3. 快速修改之前錯誤的命令
    2. 用法:
        1. 叫用編號n的歷史指令: !n
        2. 叫用往前倒數第n個歷史指令: !-n
        3. 執行前一個歷史指令: !!
        4. 執行最近一個以"字串"開頭的歷史指令: !字串
        5. 移除後面檔名: !!:h
        6. 移除前面的目錄: !!:t
## Chapter 16 使用shell script撰寫文字和圖形介面程式  
### 1. 使用dialog撰寫文字介面程式
### 2. 使用zenity撰寫圖形介面程式
## Chapter 17 檔案操作
### 1. 取得目錄內容: 檔案清單
    1. 利用ls, find, for取得目錄內容
### 2. 判斷檔案是否存在
    1. 判斷檔案是否存在: -f 檔案
    2. 判斷目錄是否存在: -d 目錄   
    3. 使用-r判斷讀取檔
    4. 使用-w判斷寫入權
    5. 使用-x判斷執行權
    6. 使用-s判斷檔案大小是否不為0
### 3. 建立檔案
    1. 使用轉向輸出: >test.txt
    2. 建立檔案時，指定初始化的內容: echo 'Hello Bash.' > text.txt
    3. 建立另一個檔案的副本: ln text.txt text1.txt
    4. 刪除檔案: rm text.txt
    5. 刪除檔案不經詢問: rm -f text.txt
    6. 建立目錄: mkdir testit
    7. 建立多層目錄: mkdir -p testit/t1/t2/t3
    8. 移除空目錄: rmdir testit
    9. 移除多層空目錄: rmdir -p testit/t1/t2/t3
    10. 移除非空目錄: rmdir -Rf testit
### 4. 取得檔案的屬性
    1. stat 可取用兩種資訊: 一種是檔案系統，另一種是檔案
        1. 用法: stat -c 格式代碼 檔案
    2. 特殊屬性可使用chattr 改變檔案的屬性和lsattr觀看屬性
        1. 增加特殊屬性: chattr +屬性代碼 檔案 
        2. 設定特殊屬性: chattr =屬性代碼 檔案 
        3. 移除特殊屬性: chattr -屬性代碼 檔案 
### 5. 比對檔案差異
    1. 用法: diff 選項 檔案1 檔案2
### 6. 搜尋檔案內容
    1. 用法: grep -q 關鍵字 檔案
### 7. 建立暫存檔
    1. 用法: mktemp 選項 暫存檔樣板
### 8. 拷貝檔案
    1. 用法: cp 選項 來源檔案 目的檔案
### 9. 大寫檔名、小寫檔名互換
### 10. 轉換編碼
    1. 用法: iconv -f 來源檔的編碼 -t 目的檔的編碼 來源檔  
## Chapter 18 主機系統管理
### 1. 帳號管理
### 2. DNS自動產生器
### 3. DHCP自動產生器
### 4. 偵測主機存活
## Chapter 19 Bash 在TCP/IP方面的運用
### 1. Bash 網路轉向
### 2. 自動登入FTP
### 3. 自動登入SSH
## Chapter 20 主機安全管理
### 1. 收集主機資訊
### 2. 主機服務通道
### 3. 限制連線來源
### 4. 限制連線來源-使用 iptables
### 5. 檔案完整性檢核
### 6. 郵寄通知
## Chapter 21 備份
### 1. 使用tar做備份
    1. 用法: tar cvf tar檔 檔案或目錄串列
    2. 常見壓縮工具: gzip, bzip2, xz
### 2. 使用磁帶做備份
    1. 操作磁帶機的指令是mt
### 3. 使用cpio做備份 
    1. 用"標準輸入"讀取檔案，用"標準輸出"輸出資料，本身無法單獨使用，需搭配find等工具
### 4. 使用dump/restore做備份/回復
    1. 較適合用來做整個系統的備份
### 5. 使用cp, dd做備份
    1. 用法: cp -a 來源A 目的B
    2. 使用簡單
    3. 備份應兼顧屬性
        1. 檔案權限
        2. 擁有者、群組等屬性
        3. 檔案時間 
    4. 使用 dd: dd是一種以低階的方式，拷貝檔案或轉換原始資料的工具
### 6. 使用光碟片做備份
### 7. 使用rsync做備份
    1. 可搭配rsh或ssh，甚至使用daemon模式
### 8. 使用rar加密備份
### 9. 使用bash script自動備份
    1. 自動備份 MySQL/MariaDB 資料庫 
    
